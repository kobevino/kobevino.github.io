<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="./_next/static/css/dbb50fd420b33798.css" data-precedence="next"/><link rel="stylesheet" href="./_next/static/css/1b43b2959fdf142d.css" data-precedence="next"/><link rel="stylesheet" href="./_next/static/css/4c62bdaf9ccfa79d.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="./_next/static/chunks/webpack-ebbce2ffb9d844b7.js"/><script src="./_next/static/chunks/94c12b52-02bab8f31903f9d8.js" async=""></script><script src="./_next/static/chunks/842-cb809d85f4d450a1.js" async=""></script><script src="./_next/static/chunks/main-app-82a45780c036d1fa.js" async=""></script><script src="./_next/static/chunks/2-ad9c083589494568.js" async=""></script><script src="./_next/static/chunks/979-9f1e3dabf5b88387.js" async=""></script><script src="./_next/static/chunks/34-00f8cbeb68282840.js" async=""></script><script src="./_next/static/chunks/app/layout-75c372431f7ce25f.js" async=""></script><script src="./_next/static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js" async=""></script><title>Kobe&#x27;s Blog</title><meta name="description" content="Generated by Jaesung Lee"/><link rel="icon" href="/favicon.ico"/><script data-mantine-script="true">try {
  var _colorScheme = window.localStorage.getItem("mantine-color-scheme-value");
  var colorScheme = _colorScheme === "light" || _colorScheme === "dark" || _colorScheme === "auto" ? _colorScheme : "auto";
  var computedColorScheme = colorScheme !== "auto" ? colorScheme : window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  document.documentElement.setAttribute("data-mantine-color-scheme", computedColorScheme);
} catch (e) {}
</script><script src="./_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><style data-mantine-styles="true">:root{--mantine-cursor-type: pointer;}</style><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><header class="header_header__Y50HU"><div style="--container-size:var(--container-size-md)" class="header_inner__a4TQD m_7485cace mantine-Container-root" data-size="md"><div style="--group-gap:calc(0.5rem * var(--mantine-scale));--group-align:center;--group-justify:flex-start;--group-wrap:wrap" class="header_logo__qUoMG m_4081bf90 mantine-Group-root"><div style="gap:var(--mantine-spacing-xs);align-items:center" class="m_8bffd616 mantine-Flex-root __m__-R6mnja"><img alt="logo" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/logo.png"/><p style="--text-fz:var(--mantine-font-size-sm);--text-lh:var(--mantine-line-height-sm);color:var(--mantine-color-gray-text);font-weight:700;text-transform:uppercase" class="mantine-focus-auto header_typing__A7z3E m_b6d8b162 mantine-Text-root" data-size="sm">kobevino</p></div></div><div style="--group-gap:calc(0.3125rem * var(--mantine-scale));--group-align:center;--group-justify:flex-start;--group-wrap:wrap" class="m_4081bf90 mantine-Group-root"><div style="--group-gap:calc(0.3125rem * var(--mantine-scale));--group-align:center;--group-justify:flex-start;--group-wrap:wrap;margin-top:calc(0.3125rem * var(--mantine-scale))" class="m_4081bf90 mantine-Group-root"><a class="mantine-focus-auto m_849cf0da m_b6d8b162 mantine-Text-root mantine-Anchor-root" data-underline="hover" href="https://x.com/_kobevino" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-brand-x "><path d="M4 4l11.733 16h4.267l-11.733 -16z"></path><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path></svg></a><a class="mantine-focus-auto m_849cf0da m_b6d8b162 mantine-Text-root mantine-Anchor-root" data-underline="hover" href="https://www.facebook.com/kobe8vino24" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-brand-meta "><path d="M12 10.174c1.766 -2.784 3.315 -4.174 4.648 -4.174c2 0 3.263 2.213 4 5.217c.704 2.869 .5 6.783 -2 6.783c-1.114 0 -2.648 -1.565 -4.148 -3.652a27.627 27.627 0 0 1 -2.5 -4.174z"></path><path d="M12 10.174c-1.766 -2.784 -3.315 -4.174 -4.648 -4.174c-2 0 -3.263 2.213 -4 5.217c-.704 2.869 -.5 6.783 2 6.783c1.114 0 2.648 -1.565 4.148 -3.652c1 -1.391 1.833 -2.783 2.5 -4.174z"></path></svg></a><a class="mantine-focus-auto m_849cf0da m_b6d8b162 mantine-Text-root mantine-Anchor-root" data-underline="hover" href="https://www.instagram.com/_kobevino/" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-brand-instagram "><path d="M4 4m0 4a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z"></path><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path><path d="M16.5 7.5l0 .01"></path></svg></a><a class="mantine-focus-auto m_849cf0da m_b6d8b162 mantine-Text-root mantine-Anchor-root" data-underline="hover" href="https://www.linkedin.com/in/kobevino/" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-brand-linkedin "><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path d="M8 11l0 5"></path><path d="M8 8l0 .01"></path><path d="M12 16l0 -5"></path><path d="M16 16v-3a2 2 0 0 0 -4 0"></path></svg></a><a class="mantine-focus-auto m_849cf0da m_b6d8b162 mantine-Text-root mantine-Anchor-root" data-underline="hover" href="https://github.com/kobevino" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-brand-github "><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg></a></div><div style="--switch-height:var(--switch-height-md);--switch-width:var(--switch-width-md);--switch-thumb-size:var(--switch-thumb-size-md);--switch-label-font-size:var(--switch-label-font-size-md);--switch-track-label-padding:var(--switch-track-label-padding-md);--switch-color:var(--mantine-color-dark-4);--label-fz:var(--mantine-font-size-md);--label-lh:var(--label-lh-md);margin-left:calc(0.625rem * var(--mantine-scale))" class="m_5f93f3bb mantine-Switch-root m_5f75b09e mantine-Switch-root" data-size="md" data-label-position="right"><label class="m_5f6e695e mantine-Switch-body" for="mantine-Raqnja"><input id="mantine-Raqnja" type="checkbox" role="switch" class="m_926b4011 mantine-Switch-input"/><div class="m_9307d992 mantine-Switch-track" data-label-position="right" aria-hidden="true"><span class="m_93039a1d mantine-Switch-thumb" data-reduce-motion="true"></span><span class="m_8277e082 mantine-Switch-trackLabel"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffd43b" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="tabler-icon tabler-icon-sun " style="width:calc(1rem * var(--mantine-scale));height:calc(1rem * var(--mantine-scale))"><path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"></path><path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path></svg></span></div><div class="m_d3ea56bb mantine-Switch-labelWrapper"></div></label></div></div></div></header><div style="margin-top:calc(6.25rem * var(--mantine-scale))" class="m_7485cace mantine-Container-root"><div style="--stack-gap:var(--mantine-spacing-md);--stack-align:stretch;--stack-justify:flex-start" class="m_6d731127 mantine-Stack-root"><h2 style="--title-fw:var(--mantine-h1-font-weight);--title-lh:var(--mantine-h1-line-height);--title-fz:var(--mantine-h1-font-size);font-weight:900" class="m_8a5d1357 mantine-Title-root" data-size="h1" data-order="2">CI/CD Optimization for ECS</h2><p style="--text-fz:var(--mantine-font-size-sm);--text-lh:var(--mantine-line-height-sm);color:var(--mantine-color-dimmed)" class="mantine-focus-auto m_b6d8b162 mantine-Text-root" data-size="sm">Sat, Nov 29,  2025</p></div><div style="--group-gap:var(--mantine-spacing-md);--group-align:center;--group-justify:flex-start;--group-wrap:wrap" class="markdown m_4081bf90 mantine-Group-root"><div class="markdown"><p>This was my second mission at the company, and I realized it was what I wanted to do—a first step towards DevOps.</p>
<h2>CI/CD Optimization for ECS and Static Resource Separation</h2>
<p>First of all, the below diagram shows the existing architecture.</p>
<p><img src="./ci-cd-optimization-for-ecs/existing-architecture.png" alt="existing-architecture"></p>
<p>After deploying a monolithic Nuxt project on ECS, 500 errors can occur for about a minute. This usually happens because the large Docker image (~5 GB) slows container startup and Nuxt SSR page builds, and health checks may mark the container healthy before it’s fully ready. Once the initial build and caching complete, the server responds normally.</p>
<h3>The List I have to solve</h3>
<ul>
<li><code>Docker image optimization</code> - <strong>5G -> 1G</strong></li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282A36;color:#F8F8F2" tabindex="0" data-language="dockerfile" data-theme="dracula"><code data-language="dockerfile" data-theme="dracula" style="display: grid;"><span data-line=""><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> public.ecr.aws/docker/library/node:18.17.0-alpine </span><span style="color:#FF79C6">AS</span><span style="color:#F8F8F2"> builder</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">RUN</span><span style="color:#F8F8F2"> corepack enable</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">WORKDIR</span><span style="color:#F8F8F2"> /app</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">COPY</span><span style="color:#F8F8F2"> .npmrc package.json yarn.lock ./</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">RUN</span><span style="color:#F8F8F2"> yarn install --production --frozen-lockfile</span></span>
<span data-line=""> </span>
<span data-line="" data-highlighted-line=""><span style="color:#FF79C6">COPY</span><span style="color:#F8F8F2"> . .</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">ARG</span><span style="color:#F8F8F2"> NUXT_APP_CDN_URL</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">RUN</span><span style="color:#F8F8F2"> NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> public.ecr.aws/docker/library/node:18.17.0-alpine</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">WORKDIR</span><span style="color:#F8F8F2"> /app</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">COPY</span><span style="color:#F8F8F2"> --from=builder /app/node_modules ./node_modules</span></span>
<span data-line=""><span style="color:#FF79C6">COPY</span><span style="color:#F8F8F2"> --from=builder /app/.output ./.output</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">EXPOSE</span><span style="color:#F8F8F2"> 3000</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">CMD</span><span style="color:#F8F8F2"> [ </span><span style="color:#F1FA8C">"node"</span><span style="color:#F8F8F2">, </span><span style="color:#F1FA8C">".output/server/index.mjs"</span><span style="color:#F8F8F2"> ]</span></span><button type="button" title="Copy code" aria-label="Copy code" data="FROM public.ecr.aws/docker/library/node:18.17.0-alpine AS builder

RUN corepack enable

WORKDIR /app

COPY .npmrc package.json yarn.lock ./

RUN yarn install --production --frozen-lockfile

COPY . .

ARG NUXT_APP_CDN_URL

RUN NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build

FROM public.ecr.aws/docker/library/node:18.17.0-alpine

WORKDIR /app

COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/.output ./.output

EXPOSE 3000

CMD [ &#x22;node&#x22;, &#x22;.output/server/index.mjs&#x22; ]" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>When writing a Dockerfile, one important tip is to leverage Docker layer caching by placing frequently changed parts at the bottom.</p>
<ul>
<li><code>ECR remote cache</code> : <strong>20mins -> 12mins</strong>. We have to use <code>buildx</code> command for docker layer caching. <a href="https://aws.amazon.com/ko/blogs/containers/announcing-remote-cache-support-in-amazon-ecr-for-buildkit-clients/" rel="nofollow" target="_blank">Announcing remote cache support in Amazon ECR for BuildKit clients</a></li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282A36;color:#F8F8F2" tabindex="0" data-language="yml" data-theme="dracula"><code data-language="yml" data-theme="dracula" style="display: grid;"><span data-line=""><span style="color:#8BE9FD">  build</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#8BE9FD">    commands</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> echo "Building the Docker image..."</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker buildx create --use</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#FF79C6"> |</span></span>
<span data-line=""><span style="color:#F1FA8C">        docker buildx build --build-arg NUXT_APP_CDN_URL="$CDN_URL/$COMMIT_ID" \</span></span>
<span data-line=""><span style="color:#F1FA8C">          -t "$REPOSITORY_URI"/"$IMAGE_REPO_NAME":"$IMAGE_TAG" \</span></span>
<span data-line=""><span style="color:#F1FA8C">          -t "$REPOSITORY_URI"/"$IMAGE_REPO_NAME":latest \</span></span>
<span data-line=""><span style="color:#F1FA8C">          --cache-to mode=max,image-manifest=true,oci-mediatypes=true,type=registry,ref="$REPOSITORY_URI"/"$IMAGE_REPO_NAME":"$CACHE_IMAGE_TAG" \</span></span>
<span data-line=""><span style="color:#F1FA8C">          --cache-from type=registry,ref="$REPOSITORY_URI"/"$IMAGE_REPO_NAME":"$CACHE_IMAGE_TAG" \</span></span>
<span data-line=""><span style="color:#F1FA8C">          --push .</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker create --name temp-container "$REPOSITORY_URI"/"$IMAGE_REPO_NAME":"$IMAGE_TAG"</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker cp temp-container:/app/.output/public ./static</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker rm temp-container</span></span><button type="button" title="Copy code" aria-label="Copy code" data="  build:
    commands:
      - echo &#x22;Building the Docker image...&#x22;
      - docker buildx create --use
      - |
        docker buildx build --build-arg NUXT_APP_CDN_URL=&#x22;$CDN_URL/$COMMIT_ID&#x22; \
          -t &#x22;$REPOSITORY_URI&#x22;/&#x22;$IMAGE_REPO_NAME&#x22;:&#x22;$IMAGE_TAG&#x22; \
          -t &#x22;$REPOSITORY_URI&#x22;/&#x22;$IMAGE_REPO_NAME&#x22;:latest \
          --cache-to mode=max,image-manifest=true,oci-mediatypes=true,type=registry,ref=&#x22;$REPOSITORY_URI&#x22;/&#x22;$IMAGE_REPO_NAME&#x22;:&#x22;$CACHE_IMAGE_TAG&#x22; \
          --cache-from type=registry,ref=&#x22;$REPOSITORY_URI&#x22;/&#x22;$IMAGE_REPO_NAME&#x22;:&#x22;$CACHE_IMAGE_TAG&#x22; \
          --push .
      - docker create --name temp-container &#x22;$REPOSITORY_URI&#x22;/&#x22;$IMAGE_REPO_NAME&#x22;:&#x22;$IMAGE_TAG&#x22;
      - docker cp temp-container:/app/.output/public ./static
      - docker rm temp-container" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p><img src="./ci-cd-optimization-for-ecs/ecr-remote-cache.png" alt="ecr-remote-cache">
<img src="./ci-cd-optimization-for-ecs/docker-layer-cache.png" alt="docker-layer-cache"></p>
<ul>
<li><code>static resources separation</code> : I will use the environment variable NUXT_APP_CDN_URL, which points to the CloudFront URL. During the Docker build, the static resources generated as artifacts are copied from the container to the server using the docker cp command. After the build, these files are synced to S3.</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282A36;color:#F8F8F2" tabindex="0" data-language="dockerfile" data-theme="dracula"><code data-language="dockerfile" data-theme="dracula" style="display: grid;"><span data-line=""><span style="color:#FF79C6">ARG</span><span style="color:#F8F8F2"> NUXT_APP_CDN_URL</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#FF79C6">RUN</span><span style="color:#F8F8F2"> NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build</span></span><button type="button" title="Copy code" aria-label="Copy code" data="ARG NUXT_APP_CDN_URL

RUN NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282A36;color:#F8F8F2" tabindex="0" data-language="yml" data-theme="dracula"><code data-language="yml" data-theme="dracula" style="display: grid;"><span data-line=""><span style="color:#8BE9FD">  build</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#8BE9FD">    commands</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker cp temp-container:/app/.output/public ./static</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> docker rm temp-container</span></span>
<span data-line=""><span style="color:#8BE9FD">  post_build</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#8BE9FD">    commands</span><span style="color:#FF79C6">:</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> echo "Uploading static files to S3..."</span></span>
<span data-line=""><span style="color:#FF79C6">      -</span><span style="color:#F1FA8C"> aws s3 sync ./static/ s3://"$BUCKET_NAME"/"$COMMIT_ID"</span></span><button type="button" title="Copy code" aria-label="Copy code" data="  build:
    commands:
      - docker cp temp-container:/app/.output/public ./static
      - docker rm temp-container
  post_build:
    commands:
      - echo &#x22;Uploading static files to S3...&#x22;
      - aws s3 sync ./static/ s3://&#x22;$BUCKET_NAME&#x22;/&#x22;$COMMIT_ID&#x22;" class="rehype-pretty-copy" onclick="navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(&#x27;rehype-pretty-copied&#x27;);window.setTimeout(() => this.classList.remove(&#x27;rehype-pretty-copied&#x27;), 3000);"><span class="ready"></span><span class="success"></span></button><style>:root {--copy-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E");--success-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);& span {width: 100%;aspect-ratio: 1 / 1;}& .ready {background-image: var(--copy-icon);}& .success {display: none; background-image: var(--success-icon);}}&.rehype-pretty-copied {& .success {display: block;} & .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;& .ready { display: none; }& .success { display: block; }}</style></code></pre></figure>
<p>Finally, I designed new architecture. BOOM!</p>
<p><img src="./ci-cd-optimization-for-ecs/new-architecture.png" alt="new-architecture"></p>
<h3>Issue and Solution</h3>
<p><img src="./ci-cd-optimization-for-ecs/cors-issue.png" alt="cors-issue"></p>
<p>This was the biggest issue after changing a new architecture. After the TTL expires, CORS errors occur due to client requests without an Origin header.</p>
<p><img src="./ci-cd-optimization-for-ecs/cloudfront-1.png" alt="cloudfront-1">
<img src="./ci-cd-optimization-for-ecs/cloudfront-2.png" alt="cloudfront-2"></p>
<p><strong>CORS preflight</strong> is a mechanism where the browser checks with the server before sending certain cross-origin requests (like POST, PUT, or requests with custom headers). The browser sends an OPTIONS request to ask if the actual request is allowed.</p>
<p>If the server doesn’t handle OPTIONS requests or return the proper CORS headers (Access-Control-Allow-Methods, Access-Control-Allow-Headers), the browser will block the request and raise a CORS error.</p>
<p>To fix this, you need to allow the <code>OPTIONS</code> method and configure CORS to handle preflight requests, ensuring that cross-origin requests can succeed safely.</p>
<h2>Wrap Up</h2>
<p>I've worked as a frontend engineer for about 10 years. Looking back on my career, the thing I love the most about myself is that I really care about learning new things. When I worked on the projects above, I realized there were areas where I was lacking. To improve, I spent my weekends attending free courses for professionals. It was a great opportunity to strengthen my fundamental knowledge, and meeting people at the academy inspired me to work even harder.</p></div></div><div></div></div><script src="./_next/static/chunks/webpack-ebbce2ffb9d844b7.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"./_next/static/css/dbb50fd420b33798.css\",\"style\"]\n2:HL[\"./_next/static/css/1b43b2959fdf142d.css\",\"style\"]\n3:HL[\"./_next/static/css/4c62bdaf9ccfa79d.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[9148,[],\"\"]\n7:I[6731,[],\"\"]\n9:I[2923,[],\"\"]\na:I[5403,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"979\",\"static/chunks/979-9f1e3dabf5b88387.js\",\"34\",\"static/chunks/34-00f8cbeb68282840.js\",\"185\",\"static/chunks/app/layout-75c372431f7ce25f.js\"],\"ColorSchemeScript\"]\nb:I[9420,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"979\",\"static/chunks/979-9f1e3dabf5b88387.js\",\"34\",\"static/chunks/34-00f8cbeb68282840.js\",\"185\",\"static/chunks/app/layout-75c372431f7ce25f.js\"],\"MantineProvider\"]\nc:I[7513,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"979\",\"static/chunks/979-9f1e3dabf5b88387.js\",\"34\",\"static/chunks/34-00f8cbeb68282840.js\",\"185\",\"static/chunks/app/layout-75c372431f7ce25f.js\"],\"Header\"]\nd:I[863,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"979\",\"static/chunks/979-9f1e3dabf5b88387.js\",\"34\",\"static/chunks/34-00f8cbeb68282840.js\",\"185\",\"static/chunks/app/layout-75c372431f7ce25f.js\"],\"Container\"]\nf:I[7792,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js\"],\"Title\"]\n10:I[8002,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js\"],\"Text\"]\n12:I[1304,[],\"\"]\n8:[\"slug\",\"ci-cd-optimization-for-ecs\",\"d\"]\ne:T53f,M62.6 142c-2.133 0-3.2-1.067-3.2-3.2V118h-56c-2 0-3-1-3-3V92.8c0-1.333.4-2.733 1.2-4.2L58.2 4c.8-1.333 2.067-2 3.8-2h28c2 0 3 1 3 3v85.4h11.2c.933 0 1.733.333 2.4 1 .667.533 1 1.267 1 2.2v21.2c0 .933-.333 1.733-1 2.4-.667.533-1.467.8-2.4.8H93v20.8c0 2.133-1.067 3.2-3.2 3.2H62.6zM33 90.4h26.4V51.2L33 90.4zM181.67 144.6c-7.333 0-14.333-1.333-21-4-6.666-2.667-12.866-6.733-18.6-12.2-5.733-5.467-10.266-13-13.6-22.6-3.333-9.6-5-20.667-5-33.2 0-12.533 1.667-23.6 5-33.2 3.334-9.6 7.867-17.133 13.6-22.6 5.734-5.467 11.934-9.533 18.6-12.2 6.667-2.8 13.667-4.2 21-4.2 7.467 0 14.534 1.4 21.2 4.2 6.667 2.667 12.8 6.733 18.4 12.2 5.734 5.467 10.267 13 13.6 22.6 3.334 9.6 5 20.667 5 33.2 0 12.533-1.666 23.6-5 33.2-3.333 9.6-7.866 17.133-13.6 22.6-5.6 5.467-11.733 9.533-18.4 12.2-6.666 2.667-13.733 4-21.2 4zm0-31c9.067 0 15.6-3.733 19.6-11.2 4."])</script><script>self.__next_f.push([1,"134-7.6 6.2-17.533 6.2-29.8s-2.066-22.2-6.2-29.8c-4.133-7.6-10.666-11.4-19.6-11.4-8.933 0-15.466 3.8-19.6 11.4-4 7.6-6 17.533-6 29.8s2 22.2 6 29.8c4.134 7.467 10.667 11.2 19.6 11.2zM316.116 142c-2.134 0-3.2-1.067-3.2-3.2V118h-56c-2 0-3-1-3-3V92.8c0-1.333.4-2.733 1.2-4.2l56.6-84.6c.8-1.333 2.066-2 3.8-2h28c2 0 3 1 3 3v85.4h11.2c.933 0 1.733.333 2.4 1 .666.533 1 1.267 1 2.2v21.2c0 .933-.334 1.733-1 2.4-.667.533-1.467.8-2.4.8h-11.2v20.8c0 2.133-1.067 3.2-3.2 3.2h-27.2zm-29.6-51.6h26.4V51.2l-26.4 39.2z13:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"./_next/static/css/dbb50fd420b33798.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"./_next/static/css/1b43b2959fdf142d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"Rl2bWh7SpXcU_k5oHxIGK\",\"assetPrefix\":\".\",\"initialCanonicalUrl\":\"/ci-cd-optimization-for-ecs\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"ci-cd-optimization-for-ecs\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"ci-cd-optimization-for-ecs\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"ci-cd-optimization-for-ecs\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\"],null],null]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"./_next/static/css/4c62bdaf9ccfa79d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"$La\",null,{\"defaultColorScheme\":\"auto\"}]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$Lb\",null,{\"theme\":{\"cursorType\":\"pointer\"},\"defaultColorScheme\":\"auto\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"$Ld\",null,{\"mt\":100,\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$Ld\",null,{\"className\":\"not-found_root___8tHH\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-found_inner__jk2We\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 362 145\",\"className\":\"not-found_image__klXiS\",\"children\":[[\"$\",\"title\",null,{\"children\":\"404\"}],[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"$e\"}]]}],[\"$\",\"div\",null,{\"className\":\"not-found_content__cklTM\",\"children\":[[\"$\",\"$Lf\",null,{\"className\":\"not-found_title__bOfUG\",\"children\":\"Nothing to see here\"}],[\"$\",\"$L10\",null,{\"c\":\"dimmed\",\"size\":\"lg\",\"ta\":\"center\",\"className\":\"not-found_description__7RPJl\",\"children\":\"Page you are trying to open does not exist. You may have mistyped the address, or the page has been moved to another URL. If you think this is an error contact support.\"}]]}]]}]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"./_next/static/css/9b82fbf9d3dab81a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"styles\":null}]}]]}]}]]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$L11\"],\"globalErrorComponent\":\"$12\",\"missingSlots\":\"$W13\"}]]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Kobe's Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Generated by Jaesung Lee\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"14:I[5287,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js\"],\"Stack\"]\n15:I[9231,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js\"],\"Group\"]\n17:I[3179,[\"2\",\"static/chunks/2-ad9c083589494568.js\",\"42\",\"static/chunks/app/%5Bslug%5D/page-cdea868390d0022c.js\"],\"Comments\"]\n16:T4bfd,"])</script><script>self.__next_f.push([1,"\u003cp\u003eThis was my second mission at the company, and I realized it was what I wanted to do—a first step towards DevOps.\u003c/p\u003e\n\u003ch2\u003eCI/CD Optimization for ECS and Static Resource Separation\u003c/h2\u003e\n\u003cp\u003eFirst of all, the below diagram shows the existing architecture.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"./ci-cd-optimization-for-ecs/existing-architecture.png\" alt=\"existing-architecture\"\u003e\u003c/p\u003e\n\u003cp\u003eAfter deploying a monolithic Nuxt project on ECS, 500 errors can occur for about a minute. This usually happens because the large Docker image (~5 GB) slows container startup and Nuxt SSR page builds, and health checks may mark the container healthy before it’s fully ready. Once the initial build and caching complete, the server responds normally.\u003c/p\u003e\n\u003ch3\u003eThe List I have to solve\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eDocker image optimization\u003c/code\u003e - \u003cstrong\u003e5G -\u003e 1G\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282A36;color:#F8F8F2\" tabindex=\"0\" data-language=\"dockerfile\" data-theme=\"dracula\"\u003e\u003ccode data-language=\"dockerfile\" data-theme=\"dracula\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e public.ecr.aws/docker/library/node:18.17.0-alpine \u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003eAS\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e builder\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eRUN\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e corepack enable\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eWORKDIR\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e /app\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eCOPY\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e .npmrc package.json yarn.lock ./\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eRUN\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e yarn install --production --frozen-lockfile\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\" data-highlighted-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eCOPY\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e . .\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eARG\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e NUXT_APP_CDN_URL\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eRUN\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e public.ecr.aws/docker/library/node:18.17.0-alpine\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eWORKDIR\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e /app\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eCOPY\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e --from=builder /app/node_modules ./node_modules\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eCOPY\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e --from=builder /app/.output ./.output\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eEXPOSE\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e 3000\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eCMD\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e\"node\"\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e\".output/server/index.mjs\"\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e ]\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"FROM public.ecr.aws/docker/library/node:18.17.0-alpine AS builder\n\nRUN corepack enable\n\nWORKDIR /app\n\nCOPY .npmrc package.json yarn.lock ./\n\nRUN yarn install --production --frozen-lockfile\n\nCOPY . .\n\nARG NUXT_APP_CDN_URL\n\nRUN NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build\n\nFROM public.ecr.aws/docker/library/node:18.17.0-alpine\n\nWORKDIR /app\n\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/.output ./.output\n\nEXPOSE 3000\n\nCMD [ \u0026#x22;node\u0026#x22;, \u0026#x22;.output/server/index.mjs\u0026#x22; ]\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eWhen writing a Dockerfile, one important tip is to leverage Docker layer caching by placing frequently changed parts at the bottom.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eECR remote cache\u003c/code\u003e : \u003cstrong\u003e20mins -\u003e 12mins\u003c/strong\u003e. We have to use \u003ccode\u003ebuildx\u003c/code\u003e command for docker layer caching. \u003ca href=\"https://aws.amazon.com/ko/blogs/containers/announcing-remote-cache-support-in-amazon-ecr-for-buildkit-clients/\" rel=\"nofollow\" target=\"_blank\"\u003eAnnouncing remote cache support in Amazon ECR for BuildKit clients\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282A36;color:#F8F8F2\" tabindex=\"0\" data-language=\"yml\" data-theme=\"dracula\"\u003e\u003ccode data-language=\"yml\" data-theme=\"dracula\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e  build\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e    commands\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e echo \"Building the Docker image...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker buildx create --use\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e |\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e        docker buildx build --build-arg NUXT_APP_CDN_URL=\"$CDN_URL/$COMMIT_ID\" \\\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e          -t \"$REPOSITORY_URI\"/\"$IMAGE_REPO_NAME\":\"$IMAGE_TAG\" \\\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e          -t \"$REPOSITORY_URI\"/\"$IMAGE_REPO_NAME\":latest \\\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e          --cache-to mode=max,image-manifest=true,oci-mediatypes=true,type=registry,ref=\"$REPOSITORY_URI\"/\"$IMAGE_REPO_NAME\":\"$CACHE_IMAGE_TAG\" \\\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e          --cache-from type=registry,ref=\"$REPOSITORY_URI\"/\"$IMAGE_REPO_NAME\":\"$CACHE_IMAGE_TAG\" \\\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#F1FA8C\"\u003e          --push .\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker create --name temp-container \"$REPOSITORY_URI\"/\"$IMAGE_REPO_NAME\":\"$IMAGE_TAG\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker cp temp-container:/app/.output/public ./static\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker rm temp-container\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"  build:\n    commands:\n      - echo \u0026#x22;Building the Docker image...\u0026#x22;\n      - docker buildx create --use\n      - |\n        docker buildx build --build-arg NUXT_APP_CDN_URL=\u0026#x22;$CDN_URL/$COMMIT_ID\u0026#x22; \\\n          -t \u0026#x22;$REPOSITORY_URI\u0026#x22;/\u0026#x22;$IMAGE_REPO_NAME\u0026#x22;:\u0026#x22;$IMAGE_TAG\u0026#x22; \\\n          -t \u0026#x22;$REPOSITORY_URI\u0026#x22;/\u0026#x22;$IMAGE_REPO_NAME\u0026#x22;:latest \\\n          --cache-to mode=max,image-manifest=true,oci-mediatypes=true,type=registry,ref=\u0026#x22;$REPOSITORY_URI\u0026#x22;/\u0026#x22;$IMAGE_REPO_NAME\u0026#x22;:\u0026#x22;$CACHE_IMAGE_TAG\u0026#x22; \\\n          --cache-from type=registry,ref=\u0026#x22;$REPOSITORY_URI\u0026#x22;/\u0026#x22;$IMAGE_REPO_NAME\u0026#x22;:\u0026#x22;$CACHE_IMAGE_TAG\u0026#x22; \\\n          --push .\n      - docker create --name temp-container \u0026#x22;$REPOSITORY_URI\u0026#x22;/\u0026#x22;$IMAGE_REPO_NAME\u0026#x22;:\u0026#x22;$IMAGE_TAG\u0026#x22;\n      - docker cp temp-container:/app/.output/public ./static\n      - docker rm temp-container\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003e\u003cimg src=\"./ci-cd-optimization-for-ecs/ecr-remote-cache.png\" alt=\"ecr-remote-cache\"\u003e\n\u003cimg src=\"./ci-cd-optimization-for-ecs/docker-layer-cache.png\" alt=\"docker-layer-cache\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003estatic resources separation\u003c/code\u003e : I will use the environment variable NUXT_APP_CDN_URL, which points to the CloudFront URL. During the Docker build, the static resources generated as artifacts are copied from the container to the server using the docker cp command. After the build, these files are synced to S3.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282A36;color:#F8F8F2\" tabindex=\"0\" data-language=\"dockerfile\" data-theme=\"dracula\"\u003e\u003ccode data-language=\"dockerfile\" data-theme=\"dracula\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eARG\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e NUXT_APP_CDN_URL\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003eRUN\u003c/span\u003e\u003cspan style=\"color:#F8F8F2\"\u003e NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"ARG NUXT_APP_CDN_URL\n\nRUN NUXT_APP_CDN_URL=$NUXT_APP_CDN_URL yarn build\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282A36;color:#F8F8F2\" tabindex=\"0\" data-language=\"yml\" data-theme=\"dracula\"\u003e\u003ccode data-language=\"yml\" data-theme=\"dracula\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e  build\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e    commands\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker cp temp-container:/app/.output/public ./static\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e docker rm temp-container\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e  post_build\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#8BE9FD\"\u003e    commands\u003c/span\u003e\u003cspan style=\"color:#FF79C6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e echo \"Uploading static files to S3...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FF79C6\"\u003e      -\u003c/span\u003e\u003cspan style=\"color:#F1FA8C\"\u003e aws s3 sync ./static/ s3://\"$BUCKET_NAME\"/\"$COMMIT_ID\"\u003c/span\u003e\u003c/span\u003e\u003cbutton type=\"button\" title=\"Copy code\" aria-label=\"Copy code\" data=\"  build:\n    commands:\n      - docker cp temp-container:/app/.output/public ./static\n      - docker rm temp-container\n  post_build:\n    commands:\n      - echo \u0026#x22;Uploading static files to S3...\u0026#x22;\n      - aws s3 sync ./static/ s3://\u0026#x22;$BUCKET_NAME\u0026#x22;/\u0026#x22;$COMMIT_ID\u0026#x22;\" class=\"rehype-pretty-copy\" onclick=\"navigator.clipboard.writeText(this.attributes.data.value);this.classList.add(\u0026#x27;rehype-pretty-copied\u0026#x27;);window.setTimeout(() =\u003e this.classList.remove(\u0026#x27;rehype-pretty-copied\u0026#x27;), 3000);\"\u003e\u003cspan class=\"ready\"\u003e\u003c/span\u003e\u003cspan class=\"success\"\u003e\u003c/span\u003e\u003c/button\u003e\u003cstyle\u003e:root {--copy-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23adadad' d='M16.187 9.5H12.25a1.75 1.75 0 0 0-1.75 1.75v28.5c0 .967.784 1.75 1.75 1.75h23.5a1.75 1.75 0 0 0 1.75-1.75v-28.5a1.75 1.75 0 0 0-1.75-1.75h-3.937a4.25 4.25 0 0 1-4.063 3h-7.5a4.25 4.25 0 0 1-4.063-3M31.813 7h3.937A4.25 4.25 0 0 1 40 11.25v28.5A4.25 4.25 0 0 1 35.75 44h-23.5A4.25 4.25 0 0 1 8 39.75v-28.5A4.25 4.25 0 0 1 12.25 7h3.937a4.25 4.25 0 0 1 4.063-3h7.5a4.25 4.25 0 0 1 4.063 3M18.5 8.25c0 .966.784 1.75 1.75 1.75h7.5a1.75 1.75 0 1 0 0-3.5h-7.5a1.75 1.75 0 0 0-1.75 1.75'/%3E%3C/svg%3E\");--success-icon: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2366ff85' d='M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z'/%3E%3C/svg%3E\");}pre:has(code) {position: relative;}pre button.rehype-pretty-copy {right: 1px;padding: 0;width: 24px;height: 24px;display: flex;margin-top: 2px;margin-right: 8px;position: absolute;border-radius: 25%;backdrop-filter: blur(3px);\u0026 span {width: 100%;aspect-ratio: 1 / 1;}\u0026 .ready {background-image: var(--copy-icon);}\u0026 .success {display: none; background-image: var(--success-icon);}}\u0026.rehype-pretty-copied {\u0026 .success {display: block;} \u0026 .ready {display: none;}}pre button.rehype-pretty-copy.rehype-pretty-copied {opacity: 1;\u0026 .ready { display: none; }\u0026 .success { display: block; }}\u003c/style\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eFinally, I designed new architecture. BOOM!\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"./ci-cd-optimization-for-ecs/new-architecture.png\" alt=\"new-architecture\"\u003e\u003c/p\u003e\n\u003ch3\u003eIssue and Solution\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"./ci-cd-optimization-for-ecs/cors-issue.png\" alt=\"cors-issue\"\u003e\u003c/p\u003e\n\u003cp\u003eThis was the biggest issue after changing a new architecture. After the TTL expires, CORS errors occur due to client requests without an Origin header.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"./ci-cd-optimization-for-ecs/cloudfront-1.png\" alt=\"cloudfront-1\"\u003e\n\u003cimg src=\"./ci-cd-optimization-for-ecs/cloudfront-2.png\" alt=\"cloudfront-2\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eCORS preflight\u003c/strong\u003e is a mechanism where the browser checks with the server before sending certain cross-origin requests (like POST, PUT, or requests with custom headers). The browser sends an OPTIONS request to ask if the actual request is allowed.\u003c/p\u003e\n\u003cp\u003eIf the server doesn’t handle OPTIONS requests or return the proper CORS headers (Access-Control-Allow-Methods, Access-Control-Allow-Headers), the browser will block the request and raise a CORS error.\u003c/p\u003e\n\u003cp\u003eTo fix this, you need to allow the \u003ccode\u003eOPTIONS\u003c/code\u003e method and configure CORS to handle preflight requests, ensuring that cross-origin requests can succeed safely.\u003c/p\u003e\n\u003ch2\u003eWrap Up\u003c/h2\u003e\n\u003cp\u003eI've worked as a frontend engineer for about 10 years. Looking back on my career, the thing I love the most about myself is that I really care about learning new things. When I worked on the projects above, I realized there were areas where I was lacking. To improve, I spent my weekends attending free courses for professionals. It was a great opportunity to strengthen my fundamental knowledge, and meeting people at the academy inspired me to work even harder.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"$L14\",null,{\"children\":[[\"$\",\"$Lf\",null,{\"order\":2,\"fw\":900,\"size\":\"h1\",\"children\":\"CI/CD Optimization for ECS\"}],[\"$\",\"$L10\",null,{\"size\":\"sm\",\"c\":\"dimmed\",\"children\":\"Sat, Nov 29,  2025\"}]]}],[\"$\",\"$L15\",null,{\"className\":\"markdown\",\"children\":[\"$\",\"div\",null,{\"className\":\"markdown\",\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]}],[\"$\",\"$L17\",null,{}]]\n"])</script></body></html>